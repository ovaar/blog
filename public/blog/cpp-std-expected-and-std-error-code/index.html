<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Ovaar"><meta name=description content="Software Engineering blog"><title>Why std::expected matters for error handling - Ovaar - Software engineering blog</title><link rel=stylesheet href=/css/stylesheet.min.css><link href rel=feed type=application/rss+xml title="Ovaar - Software engineering blog"><script src=/theme-toggle.min.js></script></head><body><header><nav><a href=https://ovaar.github.io/>Ovaar - Software engineering blog</a><ul><li><a href=https://ovaar.github.io/>Home</a></li><li><a href=https://ovaar.github.io/blog/>Blog</a></li><li><a href=/tags>Tags</a></li><li><button id=theme-toggle class=theme-toggle aria-label="Toggle theme mode">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
<svg class="dark-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button></li></ul></nav><h1>Why std::expected matters for error handling</h1><p><small>published on Wed, 17 Dec 2025</small></p></header><hr><main><div class=tags><a href=/tags/cpp class=tag>#cpp</a></div><article class=content><h1 id=why-stdexpected-matters-for-error-handling>Why std::expected matters for error handling</h1><p>C++23 introduced <a href=https://en.cppreference.com/w/cpp/utility/expected.html>std::expected</a>, changing how we handle errors without exceptions. When you combine it with <a href=https://en.cppreference.com/w/cpp/error/error_code.html>std::error_code</a> (available since C++11), you get an error handling approach that forces explicit error checks while keeping your code readable.</p><p>The real power comes from <code>std::error_code</code> carrying more than just a number. Through <a href=https://en.cppreference.com/w/cpp/error/error_category.html>std::error_category</a>, it associates error codes with human-readable messages and <a href=https://en.cppreference.com/w/cpp/error/error_condition.html>std::error_condition</a> values, letting you classify errors by severity (fatal, warning, informational) rather than checking individual error codes.</p><h2 id=when-to-use-stdexpected>When to use std::expected</h2><div class=center><figure><img sizes="(min-width: 35em) 720px, 100vw" srcset='/img/Screenshot%202025-12-17%20171236_hu_e2e7e008c770ae5b.png 500w, /img/Screenshot%202025-12-17%20171236_hu_669433d492847a14.png 800w, /img/Screenshot%202025-12-17%20171236_hu_12b897804bcf5cf5.png 1200w' src=/img/Screenshot%202025-12-17%20171236.png alt="cppstat.dev - std::expected support"><figcaption>cppstat.dev - std::expected support</figcaption></figure></div><p><code>std::expected&lt;T, E></code> shines when you need clear separation between success and failure:</p><ul><li><strong>Type safety</strong>: The return value and error are distinct types. You can&rsquo;t accidentally use an error as a valid result.</li><li><strong>Explicit checks</strong>: You must check for errors before accessing the value. No more forgetting to check return codes.</li><li><strong>Functional composition</strong>: Chain operations cleanly with <code>transform()</code> and <code>or_else()</code>:<div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>return</span> <span class=nf>readFile</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>transform</span><span class=p>([](</span><span class=k>auto</span> <span class=n>content</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=n>parse</span><span class=p>(</span><span class=n>content</span><span class=p>);</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>    <span class=p>.</span><span class=n>or_else</span><span class=p>([](</span><span class=k>auto</span> <span class=n>error</span><span class=p>)</span> <span class=p>{</span> <span class=k>return</span> <span class=nf>handleError</span><span class=p>(</span><span class=n>error</span><span class=p>);</span> <span class=p>});</span>
</span></span></code></pre></div></li></ul><h2 id=when-to-combine-it-with-stderror_code>When to combine it with std::error_code</h2><p><code>std::error_code</code> makes sense for non-throwing APIs where you need more context than a simple integer:</p><ul><li><strong>No exceptions</strong>: Perfect for performance-critical code, embedded systems, or codebases with -fno-exceptions.</li><li><strong>Rich error context</strong>: Unlike <code>int VALUE_NOT_FOUND = 100</code>, error codes come with categories and conditions. You can check if an error is &ldquo;file-related&rdquo; without knowing every possible file error code.</li><li><strong>Cross-library consistency</strong>: Standard categories like <code>std::generic_category()</code> and <code>std::system_category()</code> work across different libraries.</li></ul><p>The combination <code>std::expected&lt;T, std::error_code></code> gives you the best of both worlds—type-safe error handling with rich error information.</p><h2 id=why-choose-stdexpected-over-stderror_code-alone>Why choose std::expected over std::error_code alone?</h2><p>This is a common question, and the answer reveals the design philosophy behind C++ error handling.</p><p><code>std::error_code</code> represents an error value, which typically is an integer code plus an error category. It&rsquo;s powerful but requires discipline: you can accidentally ignore it, and the error is separate from your return value (often using output parameters or special sentinel values).</p><p><code>std::expected&lt;T, E></code> takes a different approach. It&rsquo;s a type-safe container that holds <em>either</em> a value <em>or</em> an error, never both, never neither. The compiler forces you to check which one you have before accessing the value. Think of it like Rust&rsquo;s <code>Result&lt;T, E></code> or Haskell&rsquo;s <code>Either</code>.</p><p>Here&rsquo;s what sets them apart:</p><table><thead><tr><th>Aspect</th><th><code>std::error_code</code></th><th><code>std::expected&lt;T, E></code></th></tr></thead><tbody><tr><td><strong>Type safety</strong></td><td>Error separate from value; manual checks</td><td>Value and error bundled; compiler-enforced checks</td></tr><tr><td><strong>Return style</strong></td><td>Output parameters or sentinel values</td><td>Direct return type</td></tr><tr><td><strong>Error propagation</strong></td><td>Manual: <code>if (ec) return ec;</code></td><td>Functional: <code>.transform()</code>, <code>.or_else()</code></td></tr><tr><td><strong>Forgetting to check</strong></td><td>Possible—compiler won&rsquo;t warn</td><td>Impossible—can&rsquo;t access value without checking</td></tr><tr><td><strong>Performance</strong></td><td>Very cheap (integer + pointer)</td><td>Also cheap (no allocations, just a tagged union)</td></tr><tr><td><strong>Best for</strong></td><td>Legacy APIs, system integration</td><td>Modern APIs, composable code</td></tr></tbody></table><p>The best pattern? Use them together: <code>std::expected&lt;T, std::error_code></code>. You get type-safe control flow from <code>std::expected</code> plus standardized error reporting from <code>std::error_code</code>.</p><h1 id=practical-examples>Practical examples</h1><h2 id=traditional-approach-with-stderror_code>Traditional approach with std::error_code</h2><p>Here&rsquo;s the classic pattern—error code as return value, actual data as output parameter:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fstream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;filesystem&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;system_error&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>read_file</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>filesystem</span><span class=o>::</span><span class=n>path</span><span class=o>&amp;</span> <span class=n>path</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>error_code</span><span class=o>&amp;</span> <span class=n>ec</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>ifstream</span> <span class=n>file</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>binary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=n>is_open</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ec</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_error_code</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>errc</span><span class=o>::</span><span class=n>no_such_file_or_directory</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>content</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=p>.</span><span class=n>seekg</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>end</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span><span class=p>.</span><span class=n>resize</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=n>tellg</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=p>.</span><span class=n>seekg</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>beg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=n>read</span><span class=p>(</span><span class=n>content</span><span class=p>.</span><span class=n>data</span><span class=p>(),</span> <span class=n>content</span><span class=p>.</span><span class=n>size</span><span class=p>()))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ec</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>make_error_code</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>errc</span><span class=o>::</span><span class=n>io_error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ec</span><span class=p>.</span><span class=n>clear</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>error_code</span> <span class=n>ec</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>contents</span> <span class=o>=</span> <span class=n>read_file</span><span class=p>(</span><span class=s>&#34;foo.txt&#34;</span><span class=p>,</span> <span class=n>ec</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>ec</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Error: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>ec</span><span class=p>.</span><span class=n>message</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// use contents...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>This works, but notice:</p><ul><li>The function signature doesn&rsquo;t clearly show what it returns</li><li>You could forget to check <code>ec</code> and use <code>contents</code> anyway</li><li>Output parameters make the API less composable</li></ul><h2 id=modern-approach-with-stdexpected>Modern approach with std::expected</h2><p>The same functionality with <code>std::expected</code> is clearer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;expected&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;fstream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;system_error&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;filesystem&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>expected</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>error_code</span><span class=o>&gt;</span> 
</span></span><span class=line><span class=cl><span class=n>read_file</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>filesystem</span><span class=o>::</span><span class=n>path</span><span class=o>&amp;</span> <span class=n>path</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>ifstream</span> <span class=n>file</span><span class=p>(</span><span class=n>path</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>binary</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=n>is_open</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>unexpected</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_error_code</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>errc</span><span class=o>::</span><span class=n>no_such_file_or_directory</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>content</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=p>.</span><span class=n>seekg</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>end</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span><span class=p>.</span><span class=n>resize</span><span class=p>(</span><span class=n>file</span><span class=p>.</span><span class=n>tellg</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=n>file</span><span class=p>.</span><span class=n>seekg</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ios</span><span class=o>::</span><span class=n>beg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>file</span><span class=p>.</span><span class=n>read</span><span class=p>(</span><span class=n>content</span><span class=p>.</span><span class=n>data</span><span class=p>(),</span> <span class=n>content</span><span class=p>.</span><span class=n>size</span><span class=p>()))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>unexpected</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>make_error_code</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>errc</span><span class=o>::</span><span class=n>io_error</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>result</span> <span class=o>=</span> <span class=n>read_file</span><span class=p>(</span><span class=s>&#34;foo.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>result</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Error: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>result</span><span class=p>.</span><span class=n>error</span><span class=p>().</span><span class=n>message</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>result</span><span class=p>.</span><span class=n>value</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=creating-custom-error-categories-with-http-status-codes>Creating custom error categories with HTTP status codes</h2><p><code>std::error_code</code> becomes powerful when you define domain-specific categories. HTTP response codes are a perfect example—everyone knows what 404 or 500 means, but you still want to classify them generically (client error vs server error).</p><p>Here&rsquo;s a real implementation for HTTP status codes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// @file http_response_code.h
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>network</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>enum</span> <span class=k>class</span> <span class=nc>http_response_code</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>OK</span>                    <span class=o>=</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>CREATED</span>               <span class=o>=</span> <span class=mi>201</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>NO_CONTENT</span>            <span class=o>=</span> <span class=mi>204</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>BAD_REQUEST</span>           <span class=o>=</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>UNAUTHORIZED</span>          <span class=o>=</span> <span class=mi>401</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>FORBIDDEN</span>             <span class=o>=</span> <span class=mi>403</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>NOT_FOUND</span>             <span class=o>=</span> <span class=mi>404</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>INTERNAL_SERVER_ERROR</span> <span class=o>=</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>SERVICE_UNAVAILABLE</span>   <span class=o>=</span> <span class=mi>503</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=c1>// ... (complete list in actual code)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>enum</span> <span class=k>class</span> <span class=nc>http_error_condition</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>INFORMATIONAL</span> <span class=o>=</span> <span class=mi>100</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>SUCCESS</span>       <span class=o>=</span> <span class=mi>200</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>REDIRECT</span>      <span class=o>=</span> <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>CLIENT_ERROR</span>  <span class=o>=</span> <span class=mi>400</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>SERVER_ERROR</span>  <span class=o>=</span> <span class=mi>500</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>error_category</span><span class=o>&amp;</span> <span class=n>http_error_category</span><span class=p>()</span> <span class=k>noexcept</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Register with the type system
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=n>std</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>is_error_code_enum</span><span class=o>&lt;</span><span class=n>network</span><span class=o>::</span><span class=n>http_response_code</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>template</span> <span class=o>&lt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=k>struct</span> <span class=nc>is_error_condition_enum</span><span class=o>&lt;</span><span class=n>network</span><span class=o>::</span><span class=n>http_error_condition</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>error_code</span> <span class=n>make_error_code</span><span class=p>(</span><span class=n>network</span><span class=o>::</span><span class=n>http_response_code</span> <span class=n>code</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>code</span><span class=p>),</span> <span class=n>network</span><span class=o>::</span><span class=n>http_error_category</span><span class=p>()};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>inline</span> <span class=n>std</span><span class=o>::</span><span class=n>error_condition</span> <span class=n>make_error_condition</span><span class=p>(</span><span class=n>network</span><span class=o>::</span><span class=n>http_error_condition</span> <span class=n>cond</span><span class=p>)</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>cond</span><span class=p>),</span> <span class=n>network</span><span class=o>::</span><span class=n>http_error_category</span><span class=p>()};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// @file http_response_code.cpp
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>namespace</span> <span class=n>network</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>http_error_category</span> <span class=k>final</span> <span class=o>:</span> <span class=k>public</span> <span class=n>std</span><span class=o>::</span><span class=n>error_category</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=na>[[nodiscard]]</span> <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>name</span><span class=p>()</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s>&#34;http&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Error codes close to messages.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=na>[[nodiscard]]</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span> <span class=n>message</span><span class=p>(</span><span class=kt>int</span> <span class=n>ev</span><span class=p>)</span> <span class=k>const</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>switch</span> <span class=p>(</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>http_response_code</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ev</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>http_response_code</span><span class=o>::</span><span class=nl>OK</span><span class=p>:</span> <span class=k>return</span> <span class=s>&#34;OK&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>http_response_code</span><span class=o>::</span><span class=nl>NOT_FOUND</span><span class=p>:</span> <span class=k>return</span> <span class=s>&#34;Not Found&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=k>case</span> <span class=n>http_response_code</span><span class=o>::</span><span class=nl>INTERNAL_SERVER_ERROR</span><span class=p>:</span> <span class=k>return</span> <span class=s>&#34;Internal Server Error&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=k>default</span><span class=o>:</span> <span class=k>return</span> <span class=s>&#34;(unrecognized error)&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// std::error_condition classification
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>std</span><span class=o>::</span><span class=n>error_condition</span> <span class=n>default_error_condition</span><span class=p>(</span><span class=kt>int</span> <span class=n>ev</span><span class=p>)</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>const</span> <span class=k>auto</span> <span class=n>code</span> <span class=o>=</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=n>http_response_code</span><span class=o>&gt;</span><span class=p>(</span><span class=n>ev</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>code</span> <span class=o>&gt;=</span> <span class=n>http_response_code</span><span class=o>::</span><span class=n>OK</span> <span class=o>&amp;&amp;</span> <span class=n>code</span> <span class=o>&lt;</span> <span class=n>http_response_code</span><span class=p>(</span><span class=mi>300</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>make_error_condition</span><span class=p>(</span><span class=n>http_error_condition</span><span class=o>::</span><span class=n>SUCCESS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>code</span> <span class=o>&gt;=</span> <span class=n>http_response_code</span><span class=p>(</span><span class=mi>400</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=n>code</span> <span class=o>&lt;</span> <span class=n>http_response_code</span><span class=p>(</span><span class=mi>500</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>make_error_condition</span><span class=p>(</span><span class=n>http_error_condition</span><span class=o>::</span><span class=n>CLIENT_ERROR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>code</span> <span class=o>&gt;=</span> <span class=n>http_response_code</span><span class=p>(</span><span class=mi>500</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>make_error_condition</span><span class=p>(</span><span class=n>http_error_condition</span><span class=o>::</span><span class=n>SERVER_ERROR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>error_condition</span><span class=p>(</span><span class=n>ev</span><span class=p>,</span> <span class=o>*</span><span class=k>this</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=nf>equivalent</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>error_code</span><span class=o>&amp;</span> <span class=n>code</span><span class=p>,</span> <span class=kt>int</span> <span class=n>condition</span><span class=p>)</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>*</span><span class=k>this</span> <span class=o>==</span> <span class=n>code</span><span class=p>.</span><span class=n>category</span><span class=p>()</span> <span class=o>&amp;&amp;</span> 
</span></span><span class=line><span class=cl>                   <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>default_error_condition</span><span class=p>(</span><span class=n>code</span><span class=p>.</span><span class=n>value</span><span class=p>()).</span><span class=n>value</span><span class=p>())</span> <span class=o>==</span> <span class=n>condition</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kt>bool</span> <span class=nf>equivalent</span><span class=p>(</span><span class=kt>int</span> <span class=n>code</span><span class=p>,</span> <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>error_condition</span><span class=o>&amp;</span> <span class=n>condition</span><span class=p>)</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=k>override</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>default_error_condition</span><span class=p>(</span><span class=n>code</span><span class=p>)</span> <span class=o>==</span> <span class=n>condition</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>error_category</span><span class=o>&amp;</span> <span class=n>http_error_category</span><span class=p>()</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>static</span> <span class=n>http_error_category</span> <span class=n>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now you can use it elegantly:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>http_response</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>error_code</span> <span class=n>code</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>string</span>     <span class=n>body</span><span class=p>{};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=na>[[nodiscard]]</span> <span class=kt>bool</span> <span class=n>success</span><span class=p>()</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>code</span> <span class=o>==</span> <span class=n>std</span><span class=o>::</span><span class=n>make_error_condition</span><span class=p>(</span><span class=n>http_error_condition</span><span class=o>::</span><span class=n>SUCCESS</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Usage
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>auto</span> <span class=n>response</span> <span class=o>=</span> <span class=n>http_client</span><span class=p>.</span><span class=n>get</span><span class=p>(</span><span class=s>&#34;https://api.example.com/users&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Check specific code
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=n>code</span> <span class=o>==</span> <span class=n>http_response_code</span><span class=o>::</span><span class=n>NOT_FOUND</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Resource not found</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Or check generic condition - this is the power of error_condition
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=n>code</span> <span class=o>==</span> <span class=n>http_error_condition</span><span class=o>::</span><span class=n>CLIENT_ERROR</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Handles 400, 401, 403, 404, etc. without checking each one
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>cerr</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Client error: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>response</span><span class=p>.</span><span class=n>code</span><span class=p>.</span><span class=n>message</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=n>code</span> <span class=o>==</span> <span class=n>http_error_condition</span><span class=o>::</span><span class=n>SERVER_ERROR</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Handles 500, 503, etc.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>retry_request</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The beauty here: you can check for broad categories (<code>CLIENT_ERROR</code>) without knowing every specific code. This is what makes <code>std::error_condition</code> valuable—it carries the semantic weight of error classification.</p><h2 id=chaining-operations-functionally>Chaining operations functionally</h2><p>One of the biggest advantages of <code>std::expected</code> is composability. You can chain operations without nested if-statements. Here&rsquo;s a real-world example from XML parsing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Get a child element by name
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>expected</span><span class=o>&lt;</span><span class=n>XmlElement</span><span class=o>*</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>error_code</span><span class=o>&gt;</span> 
</span></span><span class=line><span class=cl><span class=n>get_child_element</span><span class=p>(</span><span class=n>XmlElement</span><span class=o>*</span> <span class=n>parent</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string_view</span> <span class=n>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>auto</span> <span class=n>child</span> <span class=o>=</span> <span class=n>parent</span><span class=o>-&gt;</span><span class=n>first_child_element</span><span class=p>(</span><span class=n>name</span><span class=p>.</span><span class=n>data</span><span class=p>());</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>child</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>unexpected</span><span class=p>(</span><span class=n>xml_errc</span><span class=o>::</span><span class=n>node_not_found</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>child</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Extract text from an element
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>expected</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>error_code</span><span class=o>&gt;</span> 
</span></span><span class=line><span class=cl><span class=n>get_element_text</span><span class=p>(</span><span class=k>const</span> <span class=n>XmlElement</span><span class=o>*</span> <span class=n>element</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>text</span> <span class=o>=</span> <span class=n>element</span><span class=o>-&gt;</span><span class=n>get_text</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>unexpected</span><span class=p>(</span><span class=n>xml_errc</span><span class=o>::</span><span class=n>node_empty</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=p>(</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Extract integer from an element  
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>expected</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>error_code</span><span class=o>&gt;</span> 
</span></span><span class=line><span class=cl><span class=n>get_element_int</span><span class=p>(</span><span class=k>const</span> <span class=n>XmlElement</span><span class=o>*</span> <span class=n>element</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>element</span><span class=o>-&gt;</span><span class=n>query_int_text</span><span class=p>(</span><span class=o>&amp;</span><span class=n>value</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>unexpected</span><span class=p>(</span><span class=n>xml_errc</span><span class=o>::</span><span class=n>parse_error</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Compose them with error handling
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>get_element_value</span><span class=p>(</span><span class=n>XmlElement</span><span class=o>*</span> <span class=n>parent</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>string_view</span> <span class=n>name</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nf>constexpr</span> <span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>is_same_v</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=kt>int</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>get_child_element</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>or_else</span><span class=p>(</span><span class=n>log_parse_error</span><span class=p>(</span><span class=n>name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>and_then</span><span class=p>(</span><span class=n>get_element_int</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nf>get_child_element</span><span class=p>(</span><span class=n>parent</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>or_else</span><span class=p>(</span><span class=n>log_parse_error</span><span class=p>(</span><span class=n>name</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>and_then</span><span class=p>(</span><span class=n>get_element_text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Usage - clean and error-safe
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>auto</span> <span class=n>name</span> <span class=o>=</span> <span class=n>get_element_value</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>string</span><span class=o>&gt;</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=s>&#34;username&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>auto</span> <span class=n>age</span> <span class=o>=</span> <span class=n>get_element_value</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>root</span><span class=p>,</span> <span class=s>&#34;age&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>name</span> <span class=o>&amp;&amp;</span> <span class=n>age</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>process_user</span><span class=p>(</span><span class=n>name</span><span class=p>.</span><span class=n>value</span><span class=p>(),</span> <span class=n>age</span><span class=p>.</span><span class=n>value</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Errors already logged via or_else
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>std</span><span class=o>::</span><span class=n>unexpected</span><span class=p>(</span><span class=n>xml_errc</span><span class=o>::</span><span class=n>invalid_user_data</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This is similar to Rust&rsquo;s <code>?</code> operator or functional programming&rsquo;s monadic composition. Each step automatically propagates errors, and <code>.or_else()</code> lets you handle errors inline without breaking the chain. No nested if-statements, no manual error propagation—the type system handles it.</p><h1 id=lessons-learned>Lessons learned</h1><p>After working with both <code>std::error_code</code> and <code>std::expected</code> in production code, here are the key takeaways:</p><p><strong>Do:</strong></p><ul><li>Use <code>std::expected&lt;T, std::error_code></code> for new APIs—it&rsquo;s self-documenting and safe</li><li>Create custom error categories for domain-specific errors</li><li>Map custom errors to standard conditions via <code>default_error_condition()</code></li><li>Leverage functional composition with <code>.and_then()</code>, <code>.transform()</code>, and <code>.or_else()</code></li></ul><p><strong>Don&rsquo;t:</strong></p><ul><li>Mix error handling styles in the same API boundary (exceptions + error codes + expected)</li><li>Forget that <code>result.value()</code> throws if the expected contains an error—use <code>has_value()</code> first or use <code>value_or()</code></li><li>Create too many error categories—group related errors under one category</li></ul><p><strong>Performance notes:</strong></p><ul><li>Both <code>std::error_code</code> and <code>std::expected</code> are zero-cost abstractions</li><li><code>std::expected</code> uses a tagged union internally—no heap allocations</li><li>Error message strings are only generated when you call <code>.message()</code>, not on construction</li></ul><p><strong>Migration path:</strong>
If you&rsquo;re converting an existing codebase:</p><ol><li>Start by wrapping <code>std::error_code</code> in <code>std::expected</code> at API boundaries</li><li>Gradually convert internal functions to return <code>std::expected</code> directly</li><li>Keep error categories consistent across old and new code</li></ol><h2 id=a-critical-gotcha-error-categories-must-be-in-shared-libraries>A critical gotcha: error categories must be in shared libraries</h2><p>This is important and non-obvious: <strong>error category definitions must be in a compiled translation unit (<code>.cpp</code> file), not header-only.</strong> If you define your category in a header that gets included in multiple translation units, error comparisons will break.</p><p>Why? The standard library&rsquo;s <code>error_category</code> equality comparison uses pointer identity, not value comparison:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// Inside std::error_category
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>bool</span> <span class=k>operator</span><span class=o>==</span><span class=p>(</span><span class=k>const</span> <span class=n>error_category</span><span class=o>&amp;</span> <span class=n>rhs</span><span class=p>)</span> <span class=k>const</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>this</span> <span class=o>==</span> <span class=o>&amp;</span><span class=n>rhs</span><span class=p>;</span>  <span class=c1>// Pointer comparison!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div><p>If your category is defined in a header, each translation unit gets its own instance. The pointers differ, so comparisons fail—even though they represent the same category.</p><p><strong>The fix:</strong> Always define your category instance in a <code>.cpp</code> file and return it by reference:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// http_response_code.cpp - NOT in the header!
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=n>network</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>http_error_category</span> <span class=k>final</span> <span class=o>:</span> <span class=k>public</span> <span class=n>std</span><span class=o>::</span><span class=n>error_category</span> <span class=p>{</span> <span class=cm>/* ... */</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>error_category</span><span class=o>&amp;</span> <span class=n>http_error_category</span><span class=p>()</span> <span class=k>noexcept</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>static</span> <span class=n>http_error_category</span> <span class=n>instance</span><span class=p>;</span>  <span class=c1>// Single instance
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>instance</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Then in your header, only declare the function:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// http_response_code.h
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=n>network</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>error_category</span><span class=o>&amp;</span> <span class=n>http_error_category</span><span class=p>()</span> <span class=k>noexcept</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This ensures every translation unit uses the same category instance, making pointer comparisons work correctly. This requirement ties error categories to compiled libraries—you can&rsquo;t easily use them in header-only libraries without workarounds.</p><h1 id=conclusion>Conclusion</h1><p>The combination of <code>std::expected</code> and <code>std::error_code</code> gives you the best of both worlds: type-safe APIs with rich, standardized error information. <code>std::error_condition</code> adds semantic weight by letting you classify errors generically (like HTTP&rsquo;s client vs server errors) without checking individual codes.</p><p>It&rsquo;s the current C++ way to handle errors without exceptions—just watch out for that category definition gotcha
The combination of <code>std::expected</code> and <code>std::error_code</code> gives you the best of both worlds: type-safe APIs with rich, standardized error information. It&rsquo;s the current C++ way to handle errors without exceptions.</p></article></main><footer><footer><hr><div class=footer-content><div class=footer-info><p><small>Copyright &#169; 2020 Ovaar. This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</small></p><p><small>created with <a href=https://gohugo.io>Hugo</a>,
<a href=https://github.com/andybrewer/mvp>mvp.css</a>.</small></p></div><div class=footer-social><div class=social><a href=https://github.com/ovaar target=_blank rel="noopener noreferrer" aria-label="github profile"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://www.linkedin.com/in/thomas-reynders-6bb57057/ target=_blank rel="noopener noreferrer" aria-label="linkedin profile"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></div></footer></footer></body></html>