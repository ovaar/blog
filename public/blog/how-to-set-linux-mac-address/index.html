<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Ovaar"><meta name=description content="Software Engineering blog"><title>How to set Linux MAC address - Ovaar - Software engineering blog</title><link rel=stylesheet href=/css/stylesheet.min.css><link href rel=feed type=application/rss+xml title="Ovaar - Software engineering blog"><script src=/theme-toggle.min.js></script></head><body><header><nav><a href=/>Ovaar - Software engineering blog</a><ul><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/tags>Tags</a></li><li><button id=theme-toggle class=theme-toggle aria-label="Toggle theme mode">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
<svg class="dark-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button></li></ul></nav><h1>How to set Linux MAC address</h1><p><small>published on Mon, 27 Jul 2020</small></p></header><hr><main><div class=tags><a href=/tags/linux class=tag>#linux</a>
<a href=/tags/yocto class=tag>#yocto</a></div><article class=content><p><a href=/blog/how-to-create-an-interactive-yocto-shell/>Last post</a> I wrote about a embedded device running Linux where a MAC address is stored in the EEPROM. The first six bytes are reserved for the MAC address which (ideally) only should be written once.</p><p>To apply the MAC address the numbers need to be hexadecimal formatted and separated with a colon(<code>:</code>) symbol. It is possible to dynamically change the MAC address of Ethernet, beware that you need to be <code>root</code> and that the ethernet interface is not up.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ifconfig eth0 hw ether 00:01:02:03:04:05
</span></span></code></pre></div><p>Or, you could permanently change the MAC address by setting it into the <code>hwaddress</code> in the <code>/etc/network/interfaces</code> configuration file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>auto eth0
</span></span><span class=line><span class=cl>iface eth0 inet dhcp
</span></span><span class=line><span class=cl>    hwaddress ether 00:01:02:03:04:05
</span></span></code></pre></div><p>Now we know how and where to set the MAC address. Next, we can read the first six bytes using <code>dd</code> and pipe it to <code>hexdump</code>. Fortunately, <a href=https://www.man7.org/linux/man-pages/man1/hexdump.1.html>hexdump</a> already provides API for formatting the input.</p><p>The <code>-e '1/1' %02x</code> parameter will format each space followed by a byte into a hexadecimal number with two digits and a leading zero if needed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>DELIMITER</span><span class=o>=</span><span class=s2>&#34;:&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>MAC</span><span class=o>=</span><span class=k>$(</span>dd <span class=k>if</span><span class=o>=</span><span class=nv>$EEPROM</span> <span class=nv>bs</span><span class=o>=</span><span class=m>6</span> <span class=nv>count</span><span class=o>=</span><span class=m>1</span> <span class=p>|</span> hexdump -ve <span class=s1>&#39;1/1 &#34;%02x&#39;</span><span class=s2>&#34;</span><span class=nv>$DELIMITER</span><span class=s2>&#34;</span><span class=s1>&#39;&#34;&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=nv>$MAC</span> <span class=c1># output 00:01:02:03:04:05:</span>
</span></span></code></pre></div><p>Finnaly the trailing colon <code>:</code> needs to be removed. There are multiple ways to do this</p><ol><li>Pipe the output to <code>sed</code> and replace the last <code>:</code> OR</li><li>Use Bash Substring Expansion to remove the character from a string.</li></ol><p>Solution 1:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>MAC</span><span class=o>=</span><span class=k>$(</span>dd <span class=k>if</span><span class=o>=</span><span class=nv>$EEPROM</span> <span class=nv>bs</span><span class=o>=</span><span class=m>6</span> <span class=nv>count</span><span class=o>=</span><span class=m>1</span> <span class=p>|</span> hexdump -ve <span class=s1>&#39;1/1 &#34;%02x&#39;</span><span class=s2>&#34;</span><span class=nv>$DELIMITER</span><span class=s2>&#34;</span><span class=s1>&#39;&#34;&#39;</span> <span class=p>|</span> sed s/:$//g<span class=k>)</span>
</span></span></code></pre></div><p>Solution 2:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>MAC</span><span class=o>=</span><span class=k>$(</span>dd <span class=k>if</span><span class=o>=</span><span class=nv>$EEPROM</span> <span class=nv>bs</span><span class=o>=</span><span class=m>6</span> <span class=nv>count</span><span class=o>=</span><span class=m>1</span> <span class=p>|</span> hexdump -ve <span class=s1>&#39;1/1 &#34;%02x&#39;</span><span class=s2>&#34;</span><span class=nv>$DELIMITER</span><span class=s2>&#34;</span><span class=s1>&#39;&#34;&#39;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>MAC</span><span class=o>=</span><span class=si>${</span><span class=nv>MAC</span><span class=p>:</span><span class=k>:-</span><span class=nv>1</span><span class=si>}</span> <span class=c1># Remove last character &#39;:&#39;</span>
</span></span></code></pre></div><p>Personally I prefer solution 2 since I find that <code>sed</code> harder to read and I often have to explain it to other engineers who are reviewing it. Therefore solution 2 (with a comment) is clearer. If you are a system expert and love one-lines, go for solution 1.</p></article></main><footer><footer><hr><div class=footer-content><div class=footer-info><p><small>Copyright &#169; 2020 Ovaar. This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</small></p><p><small>created with <a href=https://gohugo.io>Hugo</a>,
<a href=https://github.com/andybrewer/mvp>mvp.css</a>.</small></p></div><div class=footer-social><div class=social><a href=https://github.com/ovaar target=_blank rel="noopener noreferrer" aria-label="github profile"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://www.linkedin.com/in/thomas-reynders-6bb57057/ target=_blank rel="noopener noreferrer" aria-label="linkedin profile"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></div></footer></footer></body></html>