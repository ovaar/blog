<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Ovaar"><meta name=description content="Software Engineering blog"><title>Deploying a Blog with GitHub Actions, Docker, and Submodules - Ovaar - Software engineering blog</title><link rel=stylesheet href=/css/stylesheet.min.css><link href rel=feed type=application/rss+xml title="Ovaar - Software engineering blog"><script src=/theme-toggle.min.js></script></head><body><header><nav><a href=/>Ovaar - Software engineering blog</a><ul><li><a href=/>Home</a></li><li><a href=/blog/>Blog</a></li><li><a href=/tags>Tags</a></li><li><button id=theme-toggle class=theme-toggle aria-label="Toggle theme mode">
<svg class="light-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
<svg class="dark-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></button></li></ul></nav><h1>Deploying a Blog with GitHub Actions, Docker, and Submodules</h1><p><small>published on Fri, 31 Jan 2025</small></p></header><hr><main><div class=tags><a href=/tags/github class=tag>#github</a>
<a href=/tags/devops class=tag>#devops</a>
<a href=/tags/docker class=tag>#docker</a>
<a href=/tags/git class=tag>#git</a></div><article class=content><h2 id=-deploying-a-blog-with-github-actions-docker-and-submodules>ðŸš€ Deploying a Blog with GitHub Actions, Docker, and Submodules</h2><h3 id=-problem-statement>ðŸ“Œ Problem Statement</h3><p>If youâ€™re using GitHub Actions to <strong>build and deploy a static blog</strong> that:</p><ul><li>Runs inside <strong>Docker</strong></li><li>Pushes generated content to a <strong>GitHub Pages submodule</strong></li><li>Requires <strong>Git authentication</strong> to commit and push changes</li></ul><p>Then, you might run into permission issues, especially when pushing to submodules.</p><p>This guide walks you through setting up <strong>GitHub Actions</strong> to automatically deploy your blog <strong>without permission errors</strong>.</p><hr><h2 id=-step-1-set-up-a-github-personal-access-token-pat>âœ… Step 1: Set Up a GitHub Personal Access Token (PAT)</h2><p>GitHubâ€™s default <code>GITHUB_TOKEN</code> <strong>cannot push</strong> to repositories requiring extra permissions (like GitHub Pages). You need a <strong>Personal Access Token (PAT)</strong>.</p><h3 id=-generate-a-pat>ðŸ”¥ Generate a PAT</h3><ol><li><strong>Go to GitHub Settings â†’ Developer Settings â†’ Personal Access Tokens â†’ Fine-grained tokens</strong></li><li>Click <strong>&ldquo;Generate new token&rdquo;</strong></li><li>Set <strong>Expiration</strong>: Recommended <strong>No Expiration</strong></li><li><strong>Repository access</strong>: Select <strong>both</strong> repositories (your main repo and GitHub Pages repo)</li><li><strong>Permissions</strong>:<ul><li>âœ… <code>Contents: Read & Write</code></li><li>âœ… <code>Workflows: Read & Write</code></li></ul></li><li>Click <strong>Generate Token</strong> and <strong>copy the token</strong></li></ol><h3 id=-add-gh_pat-to-github-secrets>ðŸ”¥ Add <code>GH_PAT</code> to GitHub Secrets</h3><ul><li>Go to <strong>GitHub Repo â†’ Settings â†’ Secrets and Variables â†’ Actions</strong></li><li>Click <strong>New repository secret</strong></li><li>Name it <strong><code>GH_PAT</code></strong></li><li>Paste the copied token</li><li>Repeat steps for each submodule repository that requires access.</li></ul><hr><h2 id=-step-2-configure-github-actions-workflow>âœ… Step 2: Configure GitHub Actions Workflow</h2><p>Create <code>.github/workflows/deploy.yml</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Deploy Blog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=l>main </span><span class=w> </span><span class=c># Adjust if needed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>workflow_dispatch</span><span class=p>:</span><span class=w>  </span><span class=c># Allows manual triggering</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout repository</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>  </span><span class=c># Ensures submodules are initialized and updated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>token</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GH_PAT }}</span><span class=w> </span><span class=c># ðŸ”¥ Ensures submodules use PAT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Submodule cleanup fix </span><span class=w> </span><span class=c># Bodge for https://github.com/actions/checkout/issues/358</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          git submodule foreach --recursive git clean -ffdx
</span></span></span><span class=line><span class=cl><span class=sd>          git submodule foreach --recursive git reset --hard
</span></span></span><span class=line><span class=cl><span class=sd>          git submodule foreach --recursive git checkout -f master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run docker compose</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>docker compose up blog</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>stefanzweifel/git-auto-commit-action@v5</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>repository</span><span class=p>:</span><span class=w> </span><span class=l>public</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>branch</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w> </span><span class=c># Adjust if needed</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>push_options</span><span class=p>:</span><span class=w> </span>--<span class=l>force</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>create_branch</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></span></span></code></pre></div><hr><h2 id=-step-3-push-and-test>âœ… Step 3: Push and Test</h2><ol><li><strong>Commit and push changes</strong><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>git add .
</span></span><span class=line><span class=cl>git commit -m <span class=s2>&#34;Set up GitHub Actions deployment&#34;</span>
</span></span><span class=line><span class=cl>git push origin main
</span></span></code></pre></div></li><li><strong>Trigger the workflow manually</strong> (optional) from GitHub Actions.</li><li><strong>Check GitHub Actions logs</strong> for errors.</li></ol><hr><h2 id=-summary>ðŸŽ¯ Summary</h2><p>âœ… Use a <strong>GitHub PAT</strong> instead of <code>GITHUB_TOKEN</code> for pushing to submodules.
âœ… Pass the <strong>PAT token</strong> in <code>actions/checkout@v4</code>.
âœ… <strong>Set Git credentials</strong> in <code>deploy.sh</code>.
âœ… Update submodule <strong>remote URLs</strong> before pushing.</p><p>Now, your blog should <strong>auto-deploy</strong> whenever you push changes! ðŸš€</p><p>Need help? Drop a comment below! ðŸ˜Š</p></article></main><footer><footer><hr><div class=footer-content><div class=footer-info><p><small>Copyright &#169; 2020 Ovaar. This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</small></p><p><small>created with <a href=https://gohugo.io>Hugo</a>,
<a href=https://github.com/andybrewer/mvp>mvp.css</a>.</small></p></div><div class=footer-social><div class=social><a href=https://github.com/ovaar target=_blank rel="noopener noreferrer" aria-label="github profile"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg>
</a><a href=https://www.linkedin.com/in/thomas-reynders-6bb57057/ target=_blank rel="noopener noreferrer" aria-label="linkedin profile"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></div></div></div></footer></footer></body></html>